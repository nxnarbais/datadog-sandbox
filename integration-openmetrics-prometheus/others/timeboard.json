{"title":"[Sandbox] Open metrics / Prometheus metrics","description":"","widgets":[{"id":5307545479144734,"definition":{"type":"note","content":"# Open metrics and Prometheus\n\n## Histograms vs Distribution metrics\n\nThis dashboard is meant to be seen with 2 columns.","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":5264893179242432,"definition":{"type":"note","content":"### On the left side\n\nThe metrics from histogram metric configuration\n\n### On the right side\n\nThe metrics from distribution metric configuration","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":4790494295800862,"definition":{"type":"group","layout_type":"ordered","widgets":[{"id":5339885327527030,"definition":{"type":"note","content":"# prometheus_http_response_size_bytes\n\nThis metric is originally a Prometheus histogram and is sent twice:\n\n- as Datadog histogram: `hist.prometheus_http_response_size_bytes.sum\n` and `hist.prometheus_http_response_size_bytes.count\n`\n- as Datadog distribution metric: `distrib.prometheus_http_response_size_bytes\n`","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":3803631646280574,"definition":{"type":"note","content":"Some shortcuts:\n\n- [metric summary](/metric/summary?filter=prometheus_http_response_size_bytes)","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":8818187334416932,"definition":{"type":"toplist","requests":[{"q":"top(diff(sum:hist.prometheus_http_response_size_bytes.count{$handler} by {upper_bound}), 100, 'last', 'desc')","style":{"palette":"dog_classic"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over $handler by upper_..."}},{"id":1400278633593436,"definition":{"type":"toplist","requests":[{"q":"top(count:distrib.prometheus_http_response_size_bytes{$handler} by {upper_bound}.as_count(), 100, 'last', 'desc')","style":{"palette":"dog_classic"}}],"title":"Count of distrib.prometheus_http_response_size_bytes over $handler by upper_b..."}},{"id":5532893133308010,"definition":{"type":"timeseries","requests":[{"q":"sum:hist.prometheus_http_response_size_bytes.count{$handler} by {upper_bound}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over $handler by upper_...","show_legend":false,"legend_size":"0"}},{"id":28835872480168,"definition":{"type":"timeseries","requests":[{"q":"cumsum(count:distrib.prometheus_http_response_size_bytes{$handler} by {upper_bound})","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Count of distrib.prometheus_http_response_size_bytes over $handler by upper_b...","show_legend":false,"legend_size":"0"}},{"id":3779680994501792,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.count{$handler} by {upper_bound})","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over $handler by upper_...","show_legend":false,"legend_size":"0"}},{"id":5617324913124090,"definition":{"type":"timeseries","requests":[{"q":"count:distrib.prometheus_http_response_size_bytes{$handler} by {upper_bound}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Count of distrib.prometheus_http_response_size_bytes over $handler by upper_b...","show_legend":false,"legend_size":"0"}},{"id":2005937502389622,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.sum{$handler})","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.sum over $handler","show_legend":false,"legend_size":"0"}},{"id":8662939997430632,"definition":{"type":"timeseries","requests":[{"q":"sum:distrib.prometheus_http_response_size_bytes{$handler}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of distrib.prometheus_http_response_size_bytes over $handler","show_legend":false,"legend_size":"0"}},{"id":8316748431480736,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100.0,$handler})/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:10000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:10000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:10000000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000000000.0,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:10000000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler}), (diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler})-diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:1000000000.0,$handler}))/diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none,$handler})","display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over upper_bound:100.0,...","show_legend":false,"legend_size":"0"}},{"id":1162728400556936,"definition":{"type":"timeseries","requests":[{"q":"count:distrib.prometheus_http_response_size_bytes{upper_bound:100.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:1000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:10000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:100000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:1000000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:10000000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:1000000000.0,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count(), count:distrib.prometheus_http_response_size_bytes{upper_bound:none,$handler}.as_count()/count:distrib.prometheus_http_response_size_bytes{$handler}.as_count()","display_type":"bars","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Count of distrib.prometheus_http_response_size_bytes over upper_bound:100.0,$...","show_legend":false,"legend_size":"0"}},{"id":1993593194172226,"definition":{"type":"note","content":"On the right some percentiles just for the show ;)","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":4614784689696878,"definition":{"type":"timeseries","requests":[{"q":"p50:distrib.prometheus_http_response_size_bytes{*}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"p75:distrib.prometheus_http_response_size_bytes{*}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"p90:distrib.prometheus_http_response_size_bytes{*}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"p95:distrib.prometheus_http_response_size_bytes{*}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}},{"q":"p99:distrib.prometheus_http_response_size_bytes{*}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"distrib.prometheus_http_response_size_bytes, distrib.prometheus_http_response...","show_legend":false,"legend_size":"0"}}],"title":"prometheus_http_response_size_bytes"}},{"id":314126107806908,"definition":{"type":"group","layout_type":"ordered","widgets":[{"id":7049434391693948,"definition":{"type":"note","content":"On the right:\n\nThe result should be 0:\n\n```\ncumsum(\ndiff(sum:my_metric.count{upper_bound:highest_bound} \nby {a_tag_key}) -\ncount:my_metric{*} by {a_tag_key}.as_count())\n```\n\nHere:\n\n- my_metric: (hist|distrib).prometheus_http_response_size_bytes\n- highest_bount: None\n- a_tag_key: *","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":3011717024855684,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none}), count:distrib.prometheus_http_response_size_bytes{*}.as_count(), cumsum(diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:none})-count:distrib.prometheus_http_response_size_bytes{*}.as_count())","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over upper_bound:none"}},{"id":6651424303493840,"definition":{"type":"note","content":"On the right:\n\nThe result should be 0:\n\n```\ncumsum(\ndiff(sum:my_metric.count{upper_bound:lowest_bound} \nby {a_tag_key}) -\ncount:my_metric{upper_bound:lowest_bound} \nby {a_tag_key}.as_count())\n```\n\nHere:\n\n- my_metric: (hist|distrib).prometheus_http_response_size_bytes\n- a_tag_key: *\n- lowest_bound: 100","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":822629374478238,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100.0}), count:distrib.prometheus_http_response_size_bytes{upper_bound:100.0}.as_count(), cumsum(diff(sum:hist.prometheus_http_response_size_bytes.count{upper_bound:100.0})-count:distrib.prometheus_http_response_size_bytes{upper_bound:100.0}.as_count())","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.count over upper_bound:100.0","show_legend":false,"legend_size":"0"}},{"id":4301514865524810,"definition":{"type":"note","content":"On the right:\n\nThe result should be 0:\n\n```\ncumsum(diff(sum:my_metric.sum{*})\n- sum:my_metric{*})\n```\n\nHere:\n\n- my_metric: (hist|distrib).prometheus_http_response_size_bytes\n- a_tag_key: *","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":2436603217801486,"definition":{"type":"timeseries","requests":[{"q":"diff(sum:hist.prometheus_http_response_size_bytes.sum{*}), sum:distrib.prometheus_http_response_size_bytes{*}, cumsum(diff(sum:hist.prometheus_http_response_size_bytes.sum{*})-sum:distrib.prometheus_http_response_size_bytes{*})","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.prometheus_http_response_size_bytes.sum over *"}}],"title":"prometheus_http_response_size_bytes migration proof"}},{"id":5218117360040560,"definition":{"type":"group","layout_type":"ordered","widgets":[{"id":3467259409908368,"definition":{"type":"note","content":"# go_gc_duration_seconds\n\nThis metric is originally a Prometheus summary and is sent twice:\n\n- with config one: `hist.go_gc_duration_seconds.count\n`, `hist.go_gc_duration_seconds.quantile` and `hist.go_gc_duration_seconds.sum\n`\n- with config two: `distrib.go_gc_duration_seconds.count\n`, `distrib.go_gc_duration_seconds.quantile` and `distrib.go_gc_duration_seconds.sum\n`","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":1756125490917592,"definition":{"type":"note","content":"Some shortcuts:\n\n- [metric summary](/metric/summary?filter=go_gc_duration_seconds)","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":5356810766075608,"definition":{"type":"toplist","requests":[{"q":"top(sum:hist.go_gc_duration_seconds.quantile{$handler} by {quantile}, 100, 'last', 'desc')","style":{"palette":"dog_classic"}}],"title":"Sum of hist.go_gc_duration_seconds.quantile over $handler by quantile"}},{"id":8145644176107224,"definition":{"type":"toplist","requests":[{"q":"top(sum:distrib.go_gc_duration_seconds.quantile{$handler} by {quantile}, 100, 'last', 'desc')","style":{"palette":"dog_classic"}}],"title":"Sum of distrib.go_gc_duration_seconds.quantile over $handler by quantile"}},{"id":4150844342760510,"definition":{"type":"timeseries","requests":[{"q":"sum:hist.go_gc_duration_seconds.sum{$handler}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.go_gc_duration_seconds.sum over $handler","show_legend":false,"legend_size":"0"}},{"id":3625228305224336,"definition":{"type":"timeseries","requests":[{"q":"sum:distrib.go_gc_duration_seconds.sum{$handler}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of distrib.go_gc_duration_seconds.sum over $handler","show_legend":false,"legend_size":"0"}},{"id":8401787091343192,"definition":{"type":"timeseries","requests":[{"q":"sum:hist.go_gc_duration_seconds.count{$handler}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.go_gc_duration_seconds.count over $handler","show_legend":false,"legend_size":"0"}},{"id":6764373009809686,"definition":{"type":"timeseries","requests":[{"q":"sum:distrib.go_gc_duration_seconds.count{$handler}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of distrib.go_gc_duration_seconds.count over $handler","show_legend":false,"legend_size":"0"}},{"id":7867367485095422,"definition":{"type":"timeseries","requests":[{"q":"sum:hist.go_gc_duration_seconds.quantile{$handler} by {quantile}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of hist.go_gc_duration_seconds.quantile over $handler by quantile","show_legend":false,"legend_size":"0"}},{"id":7941760669647700,"definition":{"type":"timeseries","requests":[{"q":"sum:distrib.go_gc_duration_seconds.quantile{$handler} by {quantile}","display_type":"line","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"}}],"title":"Sum of distrib.go_gc_duration_seconds.quantile over $handler by quantile","show_legend":false,"legend_size":"0"}}],"title":"go_gc_duration_seconds"}}],"template_variables":[{"name":"handler","default":"*","prefix":"handler"}],"layout_type":"ordered","is_read_only":false,"notify_list":[],"dashboard_id":"ndg-jcc-qz4"}