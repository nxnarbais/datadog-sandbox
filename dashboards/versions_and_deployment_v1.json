{"title":"[Narbais][KB] Agent and SDK Versions and Deployment","description":"datadog_demo_keep:true","widgets":[{"id":2090383119768970,"definition":{"type":"note","content":"# Datadog Kubernetes Deployment Status\n\n### Cluster Shortcuts\n\n- [Container view](/orchestration/overview/pod?tags=$kube_cluster_name%2Ckube_namespace%3Adatadog)\n- [Infra List](/infrastructure?tags=$kube_cluster_name)\n- [Network](/network?srcQ=$kube_cluster_name%20kube_namespace%3Adatadog)\n- [Fleet Automation](/fleet)\n\n### Kubernetes Dashboards\n\n- [Kubernetes Overview](/screen/integration/86/kubernetes---overview?tpl_var_namespace=datadog&tpl_var_cluster=$kube_cluster_name.value)\n- [Pod Overview](/screen/integration/30322/kubernetes-pods-overview?tpl_var_namespace=datadog&tpl_var_cluster=$kube_cluster_name.value)\n- [Daemonset Overview](/screen/integration/30435/kubernetes-daemonsets-overview?tpl_var_kube_cluster_name=$kube_cluster_name.value&tpl_var_kube_namespace=datadog)","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":8}},{"id":4534896812623830,"definition":{"type":"note","content":"### Agent Troubleshooting\n\n```\nkubectl -n datadog exec <agent-pod-id> agent status\n```\n```\nkubectl -n datadog exec <agent-pod-id> agent diagnose\n```\n\nIf you open a ticket, do not hesitate to join a flare:\n```\nkubectl  -n datadog exec <POD_NAME> -it agent flare <CASE_ID>\n```\nFor the flare on dedicated containers check [the doc](https://docs.datadoghq.com/agent/troubleshooting/send_a_flare/?tab=agentv6v7#dedicated-containers)\n\nTo provide even more information to the support team, set the agent in [debug mode](https://docs.datadoghq.com/agent/troubleshooting/debug_mode/?tab=agentv6v7#containerized-agent) for a few minutes before sending the flare (do not forget to put it back to info level).\n```\nkubectl  -n datadog exec <POD_NAME> -it agent config set log_level debug\n```","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":4,"y":0,"width":4,"height":5}},{"id":2479076734597374,"definition":{"type":"note","content":"### Agent Tracer Troubleshooting\n\nAdd these lines to your environment variables:\n\n        - name: DD_TRACE_STARTUP_LOGS\n          value: \"true\"\n        - name: DD_TRACE_DEBUG\n          value: \"true\"\t\t\n\nDatadog documentation: [Tracer Debug Logs](https://docs.datadoghq.com/tracing/troubleshooting/tracer_debug_logs/)","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":0,"width":4,"height":3}},{"id":3105833763907898,"definition":{"type":"note","content":"Owner: ...@email.com\n\n*For any question or suggestion, please contact the owner of this dashboard*\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":3,"width":4,"height":2}},{"id":2945383843753634,"definition":{"type":"note","content":"### Setup the agent release RSS feed\n\n[Blog post](https://medium.com/@nicolas_narbais/datadog-event-platform-through-an-example-4a2a0388009e )","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":4,"y":5,"width":3,"height":3}},{"id":5210152178358078,"definition":{"title":"Agent release RSS feed","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"query_string":"source:feed @version.major:*","data_source":"event_stream","event_size":"s"},"columns":[]}],"type":"list_stream"},"layout":{"x":7,"y":5,"width":5,"height":3}},{"id":6981560811781352,"definition":{"title":"1. Datadog Agent Health","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7232963091579508,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate some information about the deployment of the Datadog Agent and their version.\n\n#### Checks\n\n- [ ] All the numbers are green\n- [ ] The orchestrator version is correct\n- [ ] The agent version is correct\n- [ ] The cluster agent version is correct\n- [ ] No errors on the hosts in the [Infra List](/infrastructure?tags=$kube_cluster_name)\n\n#### Notes\n\n- Make sure the timeframe selected is small enough to not capture information on past deployments.\n- Any issue with those widgets, refer to one of the section below.\n\n#### Troubleshooting\n\n*Note: Some of the components have to be running to get information on the links below.*\n- [Orchestrator view on the Agent](/orchestration/overview/pod?query=kube_app_component%3Aagent)\n- [Orchestrator view on the Cluster Agent](/orchestration/overview/deployment?query=kube_app_component%3Acluster-agent)\n- [Kubernetes Events](/event/explorer?query=source%3Akubernetes%20agent)","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":10}},{"id":3886682334622706,"definition":{"title":"Agent /Node","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":75,"comparator":"<"},{"palette":"black_on_light_yellow","value":100,"comparator":"<"},{"palette":"black_on_light_red","value":100,"comparator":">"},{"palette":"black_on_light_green","value":100,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.agent.running{$env,$kube_cluster_name}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name}","aggregator":"last"}],"formulas":[{"formula":"query1 / query2 * 100","number_format":{"unit":{"label":"%","type":"custom_unit_label"}}}]}],"autoscale":true,"precision":0,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":3,"y":0,"width":3,"height":2}},{"id":2787745659184464,"definition":{"title":"Trace Agent - (APM)","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":75,"comparator":"<"},{"palette":"black_on_light_yellow","value":100,"comparator":"<"},{"palette":"black_on_light_red","value":100,"comparator":">"},{"palette":"black_on_light_green","value":100,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.heartbeat{$env,$kube_cluster_name}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:datadog.agent.running{$env,$kube_cluster_name}","aggregator":"last"}],"formulas":[{"number_format":{"unit":{"label":"%","type":"custom_unit_label"}},"formula":"query1 / query2 * 100"}]}],"autoscale":true,"precision":0,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":6,"y":0,"width":3,"height":2}},{"id":969014661714164,"definition":{"title":"Process Agent /Agent - (Process)","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":75,"comparator":"<"},{"palette":"black_on_light_yellow","value":100,"comparator":"<"},{"palette":"black_on_light_red","value":100,"comparator":">"},{"palette":"black_on_light_green","value":100,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.process.agent{$env,$kube_cluster_name}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:datadog.agent.running{$env,$kube_cluster_name}","aggregator":"last"}],"formulas":[{"number_format":{"unit":{"label":"%","type":"custom_unit_label"}},"formula":"query1 / query2 * 100"}]}],"autoscale":true,"precision":0,"timeseries_background":{"yaxis":{},"type":"bars"}},"layout":{"x":9,"y":0,"width":3,"height":2}},{"id":5398445115833814,"definition":{"title":"Network /Agent ","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":75,"comparator":"<"},{"palette":"black_on_light_yellow","value":100,"comparator":"<"},{"palette":"black_on_light_red","value":100,"comparator":">"},{"palette":"black_on_light_green","value":100,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.npm.host_instance{$env,$kube_cluster_name}","aggregator":"last"},{"data_source":"metrics","name":"query3","query":"sum:datadog.agent.running{$env,$kube_cluster_name}","aggregator":"last"}],"formulas":[{"number_format":{"unit":{"label":"%","type":"custom_unit_label"}},"formula":"query1 / query3 * 100"}]}],"autoscale":true,"precision":0,"timeseries_background":{"yaxis":{},"type":"bars"}},"layout":{"x":3,"y":2,"width":3,"height":2}},{"id":3850022573711448,"definition":{"title":"Cluster Agent Count","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":1,"comparator":"<"},{"palette":"black_on_light_green","value":1,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.cluster_agent.running{$env,$kube_cluster_name}","aggregator":"last"}]}],"autoscale":true,"precision":1},"layout":{"x":6,"y":2,"width":3,"height":2}},{"id":3086514182301318,"definition":{"title":"Daemonset Ready /Node - (kube_state) - (need to select the daemonset template variable)","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":75,"comparator":"<"},{"palette":"black_on_light_yellow","value":100,"comparator":"<"},{"palette":"black_on_light_red","value":100,"comparator":">"},{"palette":"black_on_light_green","value":100,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.daemonset.ready{$env,$kube_cluster_name,$kube_daemon_set}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name}","aggregator":"last"}],"formulas":[{"formula":"query1 / query2 * 100","number_format":{"unit":{"label":"%","type":"custom_unit_label"}}}]}],"autoscale":true,"precision":0},"layout":{"x":9,"y":2,"width":3,"height":2}},{"id":6819877425757614,"definition":{"title":"Nodes by Orchestrator/Kubelet version","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name} by {kube_cluster_name,orchestrator,kubelet_version}","aggregator":"last"}],"response_format":"scalar","formulas":[{"cell_display_mode":"bar","alias":"nodes","formula":"query1","limit":{"count":10,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":3,"y":4,"width":3,"height":3}},{"id":8988712908110096,"definition":{"title":"Agent Version","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.agent.running{$env,$kube_cluster_name} by {kube_cluster_name,version}","aggregator":"last"}],"response_format":"scalar","formulas":[{"cell_display_mode":"bar","alias":"Agents","formula":"query1","limit":{"count":10,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":6,"y":4,"width":3,"height":3}},{"id":5626312560376672,"definition":{"title":"Cluster Agent Version","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.cluster_agent.running{$env,$kube_cluster_name} by {kube_cluster_name,version}","aggregator":"last"}],"response_format":"scalar","formulas":[{"cell_display_mode":"bar","alias":"Cluster Agents","formula":"query1","limit":{"count":10,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":9,"y":4,"width":3,"height":3}},{"id":5821148790994636,"definition":{"title":"Agent review per cluster","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.agent.started{$env,$kube_cluster_name} by {env,kube_cluster_name}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.agent.running{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query3","aggregator":"last"},{"query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query2","aggregator":"last"},{"query":"sum:datadog.cluster_agent.running{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query4","aggregator":"last"},{"query":"sum:datadog.trace_agent.heartbeat{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query5","aggregator":"last"},{"query":"sum:datadog.process.agent{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query6","aggregator":"last"},{"query":"sum:datadog.npm.host_instance{$env,$kube_cluster_name} by {env,kube_cluster_name}","data_source":"metrics","name":"query7","aggregator":"last"}],"formulas":[{"alias":"agent started","formula":"query1","limit":{"count":500,"order":"desc"}},{"alias":"agents","formula":"query3"},{"alias":"nodes","formula":"query2"},{"alias":"cluster agents","formula":"query4"},{"alias":"trace agents","formula":"query5"},{"alias":"process agents","formula":"query6"},{"alias":"network agents","formula":"query7"}]}]},"layout":{"x":3,"y":7,"width":9,"height":3}}]},"layout":{"x":0,"y":8,"width":12,"height":1}},{"id":6183822480952332,"definition":{"title":"1.1. Datadog Deployment Status (advanced)","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":853791872292652,"definition":{"type":"note","content":"Events","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":2,"height":4}},{"id":8840956140355438,"definition":{"title":"Agent started","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"events","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"kube_cluster_name","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"$kube_cluster_name Datadog agent started source:datadog"}}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":2,"y":0,"width":4,"height":2}},{"id":5044898331050772,"definition":{"title":"Kubernetes events","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"query_string":"source:kubernetes agent -status:info ","data_source":"event_stream","event_size":"l"},"columns":[]}],"type":"list_stream"},"layout":{"x":6,"y":0,"width":6,"height":4}},{"id":4131531028384600,"definition":{"title":"OOM","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"events","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"kube_cluster_name","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"$kube_cluster_name agent OOM"}}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":2,"y":2,"width":4,"height":2}},{"id":3155023782257654,"definition":{"type":"note","content":"Kubernetes metrics","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":4,"width":2,"height":2}},{"id":3909163307018150,"definition":{"title":"Pods /Node","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes.pods.running{$env,$kube_cluster_name,$kube_namespace} by {host}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"$kube_cluster_name Datadog agent started source:datadog "}],"markers":[],"custom_links":[{"link":"https://www.google.com?search={{kube_namespace.value}}","label":"Search Namespace on Google"}]},"layout":{"x":2,"y":4,"width":5,"height":2}},{"id":4942178848706022,"definition":{"title":"Containers /Node","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.container.ready{$env,$kube_cluster_name,$kube_namespace} by {pod_phase,name}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"$kube_cluster_name Datadog agent started source:datadog "}],"markers":[]},"layout":{"x":7,"y":4,"width":5,"height":2}},{"id":509861930733002,"definition":{"type":"note","content":"Kube State - Daemonset metrics","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":6,"width":2,"height":2}},{"id":5452676909033318,"definition":{"title":"Daemonset Pods desired /Node - (kube_state)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"desired","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.daemonset.desired{$env,$kube_cluster_name,$kube_daemon_set} by {host,name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"formulas":[{"alias":"ready","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.daemonset.ready{$env,$kube_cluster_name,$kube_daemon_set} by {host,name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"$kube_cluster_name Datadog agent started source:datadog "}],"markers":[]},"layout":{"x":2,"y":6,"width":10,"height":2}},{"id":1368979433162656,"definition":{"type":"note","content":"Kube State - Pods and Nodes metrics","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":8,"width":2,"height":4}},{"id":6581160480916232,"definition":{"title":"Pods /Phase/Node - (kube_state)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.pod.status_phase{$env,$kube_cluster_name,$kube_namespace} by {pod_phase,name,host}"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":2,"y":8,"width":5,"height":2}},{"id":4610647521987752,"definition":{"title":"Pods ready /Node - (kube state)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.pod.ready{$env,$kube_cluster_name,condition:true,$kube_namespace} by {host,kube_cluster_name}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":7,"y":8,"width":5,"height":2}},{"id":2431715444716304,"definition":{"title":"Pods in bad phase /Node - (kube_state)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.pod.status_phase{$env,$kube_cluster_name,!phase:running,!phase:succeeded,$kube_namespace} by {phase,host,name}.rollup(max)"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) OOM source:docker"}],"markers":[]},"layout":{"x":2,"y":10,"width":5,"height":2}},{"id":970167469300248,"definition":{"title":"Nodes","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"$kube_cluster_name Events from the Node Ready source:kubernetes "}],"markers":[]},"layout":{"x":7,"y":10,"width":5,"height":2}},{"id":3687175836233042,"definition":{"type":"note","content":"Others\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":12,"width":2,"height":2}},{"id":632767127555622,"definition":{"title":"Bytes sent to Datadog backend","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"network","name":"query1","indexes":["netflow-search-v2"],"compute":{"metric":"network.bytes_written","aggregation":"sum","interval":21600000},"search":{"query":"client_$env client_$kube_cluster_name client_$kube_namespace server_domain:*datadoghq.com "},"group_by":[{"facet":"server_domain"}]}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":2,"y":12,"width":5,"height":2}},{"id":813324121746058,"definition":{"title":"Cluster Agent API Requests /Status","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.cluster_agent.api_requests{$env,$kube_cluster_name} by {status}.as_count()"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":7,"y":12,"width":5,"height":2}}]},"layout":{"x":0,"y":9,"width":12,"height":1,"is_column_break":true}},{"id":1786881123779048,"definition":{"title":"2. Datadog APM / Trace Agent","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":179057737312040,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate the correct deployment of the APM.\n\n#### Checks\n\n- [ ] The number of Trace Agent matches the number of Nodes\n- [ ] The Tracer versions  are correct\n- [ ] The number ingested spans is not dropping\n- [ ] The number of indexed spans is not dropping\n\n#### Notes\n\n - Any issue refer to the trace troubleshooting doc and the trace agent troubleshooting doc\n\n#### Latest versions\n\n- [all repos](https://github.com/DataDog?q=dd-trace&type=public)\n    - [go](https://github.com/DataDog/dd-trace-go/releases)\n    - [ruby](https://github.com/DataDog/dd-trace-rb/releases)\n    - [nodejs](https://github.com/DataDog/dd-trace-js/releases)\n    - [cpp](https://github.com/DataDog/dd-trace-cpp/releases)\n    - [php](https://github.com/DataDog/dd-trace-php/releases)\n    - [python](https://github.com/DataDog/dd-trace-py/releases)\n    - [.net](https://github.com/DataDog/dd-trace-dotnet/releases)\n    - [java](https://github.com/DataDog/dd-trace-java/releases)\n\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":8}},{"id":4566854120428376,"definition":{"title":"Trace Agents","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"Trace Agents","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.heartbeat{$env,$kube_cluster_name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.node.count{$env,$kube_cluster_name}"}],"formulas":[{"formula":"query1","alias":"Nodes"}],"style":{"palette":"grey","line_type":"dashed","line_width":"normal"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"Agents","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.agent.running{$env,$kube_cluster_name}"}],"response_format":"timeseries","style":{"palette":"grey","line_type":"dashed","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) Datadog agent started source:datadog"}],"markers":[]},"layout":{"x":3,"y":0,"width":4,"height":3}},{"id":1307029391419204,"definition":{"title":"Traces received /TracerVersion/Lang","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.receiver.trace{$env,$kube_cluster_name} by {kube_cluster_name,tracer_version,lang}.as_count()","aggregator":"sum"}],"response_format":"scalar","formulas":[{"cell_display_mode":"bar","alias":"Traces","formula":"query1","limit":{"count":50,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":7,"y":0,"width":5,"height":3}},{"id":2771346965677280,"definition":{"title":"Ingested Spans /Service (all clusters)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.estimated_usage.apm.ingested_spans{$env, $kube_cluster_name} by {service}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":3,"width":4,"height":2}},{"id":8690883738384940,"definition":{"title":"Indexed Spans /Service","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"spans","name":"query1","indexes":["trace-search"],"compute":{"aggregation":"count"},"group_by":[{"facet":"service","limit":10,"sort":{"order":"desc","aggregation":"count"}},{"facet":"kube_cluster_name","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"$env $kube_cluster_name"}}],"response_format":"timeseries","style":{"palette":"dog_classic"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":7,"y":3,"width":5,"height":2}},{"id":3973840521601172,"definition":{"title":"Trace Agent - Stats Writer Payloads and Errors","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"payloads","formula":"query1"},{"alias":"errors","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.trace_agent.stats_writer.payloads{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"},{"data_source":"metrics","name":"query2","query":"avg:datadog.trace_agent.stats_writer.errors{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":5,"width":4,"height":3}},{"id":2801119288585264,"definition":{"title":"Trace Agent - Trace Writer Events and Errors","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"events","formula":"query1"},{"alias":"errors","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.trace_agent.trace_writer.payloads{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"},{"data_source":"metrics","name":"query2","query":"avg:datadog.trace_agent.trace_writer.errors{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":7,"y":5,"width":5,"height":3}},{"id":6863179162462814,"definition":{"title":"Go","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:go} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":0,"y":8,"width":4,"height":4}},{"id":5293845496552230,"definition":{"title":"Java","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:java} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":4,"y":8,"width":4,"height":4}},{"id":4883684770065018,"definition":{"title":"Ruby","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:ruby} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":8,"y":8,"width":4,"height":4}},{"id":2551560966991026,"definition":{"title":"Python","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:python} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":0,"y":12,"width":4,"height":4}},{"id":5936557932186812,"definition":{"title":"NodeJS","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:nodejs} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":4,"y":12,"width":4,"height":4}},{"id":5244403594319272,"definition":{"title":"CPP","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:cpp} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":8,"y":12,"width":4,"height":4}},{"id":4638479578846574,"definition":{"title":"PHP","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.trace_agent.receiver.trace{$kube_cluster_name,$env,lang:php} by {env,kube_cluster_name,tracer_version}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"alias":"traces","formula":"query1","limit":{"count":500,"order":"desc"}}]}]},"layout":{"x":0,"y":16,"width":4,"height":4}}]},"layout":{"x":0,"y":10,"width":12,"height":1}},{"id":4576487053902654,"definition":{"title":"2.1. Datadog APM (advanced)","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":4142562772120508,"definition":{"type":"note","content":"### Description\n\nFor a more detailed overview about the trace-agent, you can use the following dashboard: \n\n[Datadog Trace Agent Default Dashboard](/dashboard/lists?q=APM%20Datadog%20Agent%20Trace)\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":6}},{"id":2613645838092252,"definition":{"title":"Spans Dropped /Service","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.trace_agent.receiver.spans_dropped{$env,*,$kube_cluster_name} by {service}"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":0,"width":3,"height":2}},{"id":2963991976785252,"definition":{"title":"Traces Dropped /Reason","show_legend":false,"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.normalizer.traces_dropped{$env,*,$kube_cluster_name} by {reason}.as_count()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":0,"width":3,"height":2}},{"id":2270931078805448,"definition":{"title":"Tracer Errors /Service/Cause","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.tracer.trace.agent.error.counter{$env,*,$kube_cluster_name} by {cause,tracer_version,service}.as_count()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":0,"width":3,"height":2}},{"id":3966180665414780,"definition":{"title":"Refused Payloads /Service/Lang","show_legend":false,"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.receiver.payload_refused{$env,*,$kube_cluster_name} by {lang,service}.as_count()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":2,"width":3,"height":2}},{"id":3356866267244264,"definition":{"title":"Malformed Spans /Service/Reason","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.normalizer.spans_malformed{$env,*,$kube_cluster_name} by {reason,service}.as_count()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":2,"width":3,"height":2}},{"id":6522927542504306,"definition":{"title":"Tracer Rate Limit /Service","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"min:datadog.trace_agent.receiver.ratelimit{$env,*,$kube_cluster_name} by {service}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":2,"width":3,"height":2}},{"id":2690544168425826,"definition":{"title":"Self OOM kills /Host","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.trace_agent.receiver.oom_kill{$env,*,$kube_cluster_name} by {host}.as_count()"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":4,"width":3,"height":2}}]},"layout":{"x":0,"y":11,"width":12,"height":1}},{"id":7194819824760138,"definition":{"title":"3. Datadog Custom Metrics","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7119812879702566,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate the correct deployment of the agent and ensure that custom metrics are still reporting.\n\n#### Checks\n\n- [ ] The agent receives traffic on port 8125\n- [ ] The number of custom metrics is not dropping\n\n#### Notes\n\n - Any issue refer to the agent troubleshooting doc\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":4}},{"id":3827290640416960,"definition":{"title":"DogStatsD Traffic Received by the Agent on port 8125","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"network","name":"query1","indexes":["netflow-search-v2"],"compute":{"metric":"network.bytes_written","aggregation":"sum","interval":300000},"search":{"query":"network.server.port:8125 server_kube_namespace:datadog server_$kube_cluster_name server_$env "},"group_by":[]}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) Datadog agent started source:datadog"}],"markers":[]},"layout":{"x":3,"y":0,"width":4,"height":2}},{"id":7562679567942100,"definition":{"title":"Custom Metric Received (all clusters)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.metrics.custom{*}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":7,"y":0,"width":5,"height":2}},{"id":480512692980972,"definition":{"title":"DogStatsD Client Metrics and Events","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"client metrics","formula":"query1"},{"alias":"client events","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.dogstatsd.client.metrics{$env, $kube_cluster_name} by {kube_cluster_name}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:datadog.dogstatsd.client.events{$env, $kube_cluster_name} by {kube_cluster_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":2,"width":4,"height":2}},{"id":2413339854046666,"definition":{"title":"DogStatsD Client Packet Sent and Dropped","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"packet sent","formula":"query1"},{"alias":"packet dropped","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.dogstatsd.client.packets_sent{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:datadog.dogstatsd.client.packets_dropped{$env,$kube_cluster_name} by {kube_cluster_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":7,"y":2,"width":5,"height":2}}]},"layout":{"x":0,"y":12,"width":12,"height":1}},{"id":6608973189722648,"definition":{"title":"4. Datadog Logs","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2944242298496856,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate the correct deployment of the agent and ensure that logs are still reporting.\n\n#### Checks\n\n- [ ] The ingested log volume is correct\n- [ ] The indexed log volume is correct\n\n#### Notes\n\n - Any issue refer to the agent troubleshooting doc\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":4}},{"id":2004155029624262,"definition":{"title":"Ingested Logs /Service (all clusters)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.estimated_usage.logs.ingested_bytes{*} by {service}.rollup(sum)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":0,"width":4,"height":2}},{"id":5528026886728206,"definition":{"title":"Ingested Logs (metric to be created manually)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:logs.estimated.ingested_bytes{$env,$kube_cluster_name} by {env,cluster_name}.rollup(sum)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) Datadog agent started source:datadog"}],"markers":[]},"layout":{"x":7,"y":0,"width":5,"height":2}},{"id":6402131050223420,"definition":{"title":"Indexed Logs /Service (all clusters)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:datadog.estimated_usage.logs.ingested_events{datadog_is_excluded:false} by {service}.as_count().rollup(sum)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":2,"width":4,"height":2}},{"id":6515453191555080,"definition":{"title":"Indexed Logs","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"logs","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"service","limit":30,"sort":{"order":"desc","aggregation":"count"}},{"facet":"kube_cluster_name","limit":30,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"$env $kube_cluster_name"}}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) Datadog agent started source:datadog"}],"markers":[]},"layout":{"x":7,"y":2,"width":5,"height":2}}]},"layout":{"x":0,"y":13,"width":12,"height":1}},{"id":6665535885222176,"definition":{"title":"5. Datadog Live Processes","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2984956078290692,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate the correct deployment of the process agent.\n\n#### Checks\n\n- [ ] The widget display live processes CPU\n\n#### Notes\n\n - Any issue refer to the agent troubleshooting doc\n- [Live Process](/process?tags=cluster_name:$kube_cluster_name.value)\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":3}},{"id":2925204223420180,"definition":{"title":"Total CPU% /Process","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"process","name":"query1","metric":"process.stat.cpu.total_pct","limit":200,"query_filter":"$kube_cluster_name"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":0,"width":5,"height":3}}]},"layout":{"x":0,"y":14,"width":12,"height":1}},{"id":819272186204752,"definition":{"title":"6. Datadog Cluster Agent","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":1977341971366542,"definition":{"type":"note","content":"### Description\n\nThose widgets indicate the correct deployment of cluster_agent.\n\n#### Checks\n\n- [ ] At least one cluster agent is deployed\n- [ ] The version of the cluster agent is correct\n- [ ] Metrics from the cluster agent are reporting\n\n#### Notes\n\n - Any issue refer to the clusterr agent troubleshooting doc\n\n","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":4}},{"id":4954020007884014,"definition":{"title":"Cluster Agent Count","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"palette":"black_on_light_red","value":1,"comparator":"<"},{"palette":"black_on_light_green","value":1,"comparator":">="}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.cluster_agent.running{$env,$kube_cluster_name}","aggregator":"last"}]}],"autoscale":true,"precision":1,"timeseries_background":{"type":"bars","yaxis":{}}},"layout":{"x":3,"y":0,"width":2,"height":2}},{"id":1407465673034774,"definition":{"title":"Cluster Agent Version","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.cluster_agent.running{$env,$kube_cluster_name} by {kube_cluster_name,version}","aggregator":"last"}],"response_format":"scalar","formulas":[{"cell_display_mode":"bar","alias":"Cluster Agents","formula":"query1","limit":{"count":10,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":5,"y":0,"width":3,"height":2}},{"id":1276106771513508,"definition":{"title":"Container Ready (kube_state)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes_state.container.ready{$env,$kube_cluster_name} by {kube_namespace}"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"events":[{"q":"tags:($env.value AND $kube_cluster_name.value) \"datadog-cluster-agent\" SuccessfulCreate source:kubernetes"}],"markers":[]},"layout":{"x":3,"y":2,"width":5,"height":2}}]},"layout":{"x":0,"y":15,"width":12,"height":1}},{"id":6292714243197966,"definition":{"title":"RUM SDK versions","background_color":"blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6997489812741158,"definition":{"type":"note","content":"## Latest versions\n\n- [all repos](https://github.com/DataDog?q=sdk&type=public)\n    - [browser](https://www.npmjs.com/package/@datadog/browser-rum)\n    - [mobile iOS](https://github.com/DataDog/dd-sdk-ios/releases)\n    - [mobile Android](https://github.com/DataDog/dd-sdk-android/releases)\n    - [mobile React Native](https://github.com/DataDog/dd-sdk-reactnative/releases)\n    - [mobile Flutter](https://github.com/DataDog/dd-sdk-flutter/releases)\n   - [Roku](https://github.com/DataDog/dd-sdk-roku/releases)\n  ","background_color":"gray","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":2,"height":4}},{"id":7601867350443178,"definition":{"title":"RUM SDK versions","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"rum","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"sdk_version","limit":100,"sort":{"order":"desc","aggregation":"count"},"should_exclude_missing":true},{"facet":"@application.name","limit":100,"sort":{"order":"desc","aggregation":"count"},"should_exclude_missing":true}],"search":{"query":"@type:session"},"storage":"hot"}],"formulas":[{"alias":"Sessions","formula":"query1","limit":{"count":10000,"order":"desc"}}]}]},"layout":{"x":2,"y":0,"width":5,"height":4}},{"id":2537089086068912,"definition":{"title":"RUM SDK versions","type":"treemap","requests":[{"response_format":"scalar","queries":[{"data_source":"rum","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"sdk_version","limit":10,"sort":{"order":"desc","aggregation":"count"},"should_exclude_missing":true},{"facet":"@application.name","limit":10,"sort":{"order":"desc","aggregation":"count"},"should_exclude_missing":true}],"search":{"query":"@type:view"},"storage":"hot"}],"formulas":[{"formula":"query1"}]}]},"layout":{"x":7,"y":0,"width":5,"height":4}}]},"layout":{"x":0,"y":16,"width":12,"height":1}}],"template_variables":[{"name":"env","prefix":"env","available_values":[],"default":"*"},{"name":"kube_cluster_name","prefix":"kube_cluster_name","available_values":[],"default":"*"},{"name":"kube_namespace","prefix":"kube_namespace","available_values":[],"default":"datadog"},{"name":"kube_daemon_set","prefix":"kube_daemon_set","available_values":[],"default":"datadog"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","tags":["team:tps"]}