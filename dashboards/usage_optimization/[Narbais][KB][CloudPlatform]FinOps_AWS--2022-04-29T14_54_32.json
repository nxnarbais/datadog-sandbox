{"title":"[Narbais][KB][Cloud Platform] FinOps: AWS","description":"datadog_demo_keep:true","widgets":[{"id":2928634552448886,"definition":{"title":"EC2 Instances","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":8411348951125380,"definition":{"title":"Instances","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":7302519618408784,"definition":{"title":"Burstable Instances","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{$Provider,$Instance,$OS,$instance-type,instance-type:t*,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":6534160902507022,"definition":{"title":"Wrong Family Instances (custom)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{($Provider AND $Instance AND $OS AND $instance-type AND instance-type:t2* OR instance-type:m4* OR instance-type:c4* OR instance-type:r4*) AND $Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":8316448927047756,"definition":{"title":"Instances per Family","title_size":"16","title_align":"left","type":"toplist","requests":[{"formulas":[{"formula":"query1","limit":{"count":50,"order":"desc"}}],"response_format":"scalar","queries":[{"query":"sum:datadog.agent.running{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {instance-type}","data_source":"metrics","name":"query1","aggregator":"last"}]}]},"layout":{"x":0,"y":2,"width":8,"height":4}},{"id":5482162738172122,"definition":{"type":"note","content":"## EC2 family best practices :\n- https://internal_doc\n## T3 CPU baseline :\n- https://aws.amazon.com/fr/ec2/instance-types/t3/","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":2,"width":4,"height":4}},{"id":8900561433548518,"definition":{"title":"Overview per CPU Usage (Without Burstable)","title_size":"16","title_align":"left","show_legend":false,"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"max:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {host}","style":{"palette":"dog_classic"}}]},"layout":{"x":0,"y":6,"width":6,"height":3}},{"id":191287730440940,"definition":{"title":"Overview per Memory Usage (Without Burstable)","title_size":"16","title_align":"left","show_legend":false,"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"(max:system.mem.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {host} / max:system.mem.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {host}) * 100","style":{"palette":"warm"}}]},"layout":{"x":6,"y":6,"width":6,"height":3}},{"id":7192651170873348,"definition":{"title":"Overview per CPU Usage (Only Burstable)","title_size":"16","title_align":"left","show_legend":false,"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"max:system.cpu.user{$Provider,$Instance,$OS,$instance-type,instance-type:t*,$Instance-Id,$Db-Instance} by {host}","style":{"palette":"dog_classic"}}]},"layout":{"x":0,"y":9,"width":6,"height":3}},{"id":6178596562400012,"definition":{"title":"Overview per Memory Usage (Without Burstable)","title_size":"16","title_align":"left","show_legend":false,"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"(max:system.mem.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,instance-type:t*} by {host} / max:system.mem.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,instance-type:t*} by {host}) * 100","style":{"palette":"warm"}}]},"layout":{"x":6,"y":9,"width":6,"height":3}},{"id":1592991921363682,"definition":{"title":"List (Low Without Burstable)","title_size":"16","title_align":"left","time":{},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"max:system.cpu.num_cores{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"avg:system.mem.pct_usable{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query4","query":"avg:system.mem.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query5","query":"avg:system.uptime{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,!instance-type:t*} by {name,instance-type,availability-zone}","aggregator":"avg"}],"formulas":[{"alias":"CPU USED","conditional_formats":[{"palette":"white_on_green","value":60,"comparator":">"},{"palette":"red_on_white","value":40,"comparator":"<="},{"palette":"yellow_on_white","value":60,"comparator":"<"}],"cell_display_mode":"bar","formula":"query1","limit":{"count":500,"order":"desc"}},{"alias":"# of cores","cell_display_mode":"bar","formula":"query2"},{"alias":"mem available","conditional_formats":[{"palette":"red_on_white","value":0.6,"comparator":">"},{"palette":"yellow_on_white","value":0.4,"comparator":">"}],"cell_display_mode":"bar","formula":"query3"},{"alias":"MEM TOTAL","cell_display_mode":"number","formula":"query4"},{"alias":"UPTIME","cell_display_mode":"bar","formula":"query5"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":12,"width":12,"height":4}},{"id":8244811961811414,"definition":{"title":"List (Low Burstable)","title_size":"16","title_align":"left","time":{},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,instance-type:t*,$Db-Instance} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"avg:system.mem.pct_usable{$Provider,$Instance,$OS,$instance-type,$Instance-Id,instance-type:t*,$Db-Instance} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"avg:system.mem.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,instance-type:t*,$Db-Instance} by {name,instance-type,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query4","query":"avg:system.uptime{$Provider,$Instance,$OS,$instance-type,$Instance-Id,instance-type:t*,$Db-Instance} by {name,instance-type,availability-zone}","aggregator":"avg"}],"formulas":[{"alias":"CPU USED","conditional_formats":[{"palette":"red_on_white","value":10,"comparator":"<="},{"palette":"yellow_on_white","value":20,"comparator":"<="}],"cell_display_mode":"bar","formula":"query1","limit":{"count":500,"order":"desc"}},{"alias":"mem available","conditional_formats":[{"palette":"red_on_white","value":0.6,"comparator":">"},{"palette":"yellow_on_white","value":0.4,"comparator":">"}],"cell_display_mode":"bar","formula":"query2"},{"alias":"MEM TOTAL","cell_display_mode":"number","formula":"query3"},{"alias":"UPTIME","cell_display_mode":"bar","formula":"query4"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":16,"width":12,"height":3}},{"id":2883678075294106,"definition":{"title":"List (Top Credits Used Burstable) - 0,096 USD per credit (Windows) / 0,05 USD (Others)","title_size":"16","title_align":"left","time":{"live_span":"1mo"},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:aws.ec2.cpusurplus_credits_charged{$Provider,$Instance,$OS,$instance-type,instance-type:t*,$Instance-Id,$Db-Instance} by {name,instance-type,instance_id}","aggregator":"sum"},{"data_source":"metrics","name":"query2","query":"avg:aws.ec2.cpuutilization{$Provider,$Instance,$OS,$instance-type,instance-type:t*,$Instance-Id,$Db-Instance} by {name,instance-type,instance_id}","aggregator":"avg"}],"formulas":[{"alias":"CREDIT CHARGED","conditional_formats":[{"palette":"red_on_white","value":1600,"comparator":">"}],"cell_display_mode":"bar","formula":"query1","limit":{"count":500,"order":"desc"}},{"alias":"CPU","cell_display_mode":"bar","formula":"query2"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":19,"width":8,"height":4}},{"id":2341444739056390,"definition":{"type":"note","content":"# Break-even CPU % \n### If the burstable instance is above the break-even CPU %, switch to m6i/m5 is a better choice.\n## Linux\n- t3.2xlarge - 59,00%\n- t3.large - 49,00%\n- t3.medium - 87,00%\n- t3.xlarge 59,00%\n- t3a.2xlarge - 57,60%\n- t3a.large - 47,60%\n- t3a.medium - 80,80%\n- t3a.xlarge - 57,60%\n## Windows\n- t3.2xlarge - 78,67%\n- t3.large - 73,44%\n- t3.medium - 93,23%\n- t3.xlarge - 78,65%\n- t3a.2xlarge - 77,92%\n- t3a.large - 72,71%\n- t3a.medium - 90,00%\n- t3a.xlarge - 77,92%","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":19,"width":4,"height":4}},{"id":1447534931402954,"definition":{"title":"List (Wrong Family Instances)","title_size":"16","title_align":"left","time":{},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:system.uptime{(* AND * AND * AND * AND * AND * AND * AND instance-type:t2* OR instance-type:m4* OR instance-type:c4* OR instance-type:r4*) AND * AND * AND * AND * AND * AND * AND * AND * AND * AND $Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance} by {name,instance-type,availability-zone}","aggregator":"avg"}],"formulas":[{"alias":"uptime","cell_display_mode":"bar","formula":"query1","limit":{"count":500,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":23,"width":12,"height":5}},{"id":8357232938789490,"definition":{"title":"EC2 CPU Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"top10(query1)"}],"response_format":"timeseries","queries":[{"query":"avg:aws.ec2.cpuutilization{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":28,"width":12,"height":3}},{"id":4618689411237498,"definition":{"title":"EC2 Memory Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"alias":"Total","formula":"top10(query1)"},{"alias":"Used","formula":"top10(query2) - top10(query1)"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:system.mem.usable{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1"},{"query":"avg:system.mem.total{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query2"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":31,"width":12,"height":3}}]},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":1808143889453014,"definition":{"title":"EC2 Autoshutdown","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":6261666268655188,"definition":{"title":"Instances","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":6001343008923456,"definition":{"title":"PowerPolicy = 24/*","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{powerpolicy:24/*,$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":2164989105222500,"definition":{"title":"PowerPolicy not 24/*","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.cpu.user{!powerpolicy:24/*,$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":2452220086012882,"definition":{"title":"NPRD","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"max:aws.ec2.cpuutilization{env:nonpro} by {host}"}},"node_type":"host","no_metric_hosts":false,"no_group_hosts":true,"group":["powerpolicy"],"scope":[],"style":{"palette":"green_to_orange","palette_flip":false}},"layout":{"x":0,"y":2,"width":12,"height":7}},{"id":5677656983137766,"definition":{"title":"PRD","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"max:aws.ec2.cpuutilization{env:prod,$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}"}},"node_type":"host","no_metric_hosts":false,"no_group_hosts":true,"group":["powerpolicy"],"scope":["tenant_env:prd"],"style":{"palette":"green_to_orange","palette_flip":false}},"layout":{"x":0,"y":9,"width":12,"height":7}},{"id":1438408492845408,"definition":{"title":"List (Instances with 24/* PowerPolicy tag by size)","title_size":"16","title_align":"left","time":{"live_span":"1mo"},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:system.cpu.num_cores{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,powerpolicy:24/*,tenant_env:nprd} by {name,instance-type,platform,powerpolicy}","aggregator":"avg"}],"formulas":[{"alias":"NB. vCPUs","cell_display_mode":"bar","formula":"query1","limit":{"count":500,"order":"desc"}}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":16,"width":12,"height":5}},{"id":748472161908578,"definition":{"title":"Monthly Usage Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"1mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"default_zero(query2)"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"max:system.cpu.user{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {powerpolicy}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":21,"width":12,"height":5}}]},"layout":{"x":0,"y":1,"width":12,"height":1}},{"id":7565731820529266,"definition":{"title":"EBS (exclude NFS & letters after f: for Windows)","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":2819154640087730,"definition":{"title":"Volumes","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.used{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)}","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":false,"custom_unit":"(KO)","precision":0},"layout":{"x":0,"y":0,"width":3,"height":2}},{"id":3687341330613708,"definition":{"title":"Global Used","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.used{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":3,"y":0,"width":3,"height":2}},{"id":4738686906312618,"definition":{"title":"Global Free","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.free{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":6,"y":0,"width":3,"height":2}},{"id":7120937292481282,"definition":{"title":"Global Total","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.total{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":9,"y":0,"width":3,"height":2}},{"id":7275155505526396,"definition":{"title":"Overview per Disk Usage (%)","title_size":"16","title_align":"left","show_legend":false,"time":{"live_span":"15m"},"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"(avg:system.disk.used{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name} / avg:system.disk.total{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name}) * 100","style":{"palette":"dog_classic"}}]},"layout":{"x":0,"y":2,"width":9,"height":3}},{"id":329371555441084,"definition":{"type":"note","content":"## How to resize down a volume :\n- https://cloudacademy.com/blog/amazon-ebs-shink-volume/\n- https://medium.com/@m.yunan.helmy/decrease-the-size-of-ebs-volume-in-your-ec2-instance-ea326e951bce","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":9,"y":2,"width":3,"height":3}},{"id":1713933315637732,"definition":{"title":"List per disk(s)","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:system.disk.used{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name,filesystem,name}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"avg:system.disk.in_use{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name,filesystem,name}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"avg:system.disk.free{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name,filesystem,name}","aggregator":"avg"},{"data_source":"metrics","name":"query4","query":"avg:system.disk.total{$Provider AND $Instance AND $OS AND $instance-type AND $Instance-Id AND $Db-Instance AND NOT filesystem:nfs* AND device_name NOT IN (g:,h:,i:,j:,k:,l:,m:,n:,o:,p:,q:,r:,s:,t:,u:,v:,w:,x:,y:,z:)} by {device_name,filesystem,name}","aggregator":"avg"}],"formulas":[{"alias":"Used","cell_display_mode":"bar","formula":"query1"},{"alias":"%","conditional_formats":[{"palette":"red_on_white","value":0.4,"comparator":"<"},{"palette":"yellow_on_white","value":0.6,"comparator":"<"}],"cell_display_mode":"bar","formula":"query2"},{"alias":"Free","conditional_formats":[{"palette":"white_on_red","value":250000000000,"comparator":">"}],"cell_display_mode":"number","formula":"query3","limit":{"count":500,"order":"desc"}},{"alias":"Total","cell_display_mode":"number","formula":"query4"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":5,"width":12,"height":4}},{"id":5367440856567388,"definition":{"title":"List per volume(s)","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:aws.ebs.snapshot_age{$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {volume-name,volume-id,attachedto,volume-type}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"avg:aws.ebs.volume_throughput_percentage{$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {volume-name,volume-id,attachedto,volume-type}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"avg:aws.ebs.volume_read_ops{$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {volume-name,volume-id,attachedto,volume-type}.as_count()","aggregator":"avg"},{"data_source":"metrics","name":"query4","query":"avg:aws.ebs.volume_write_ops{$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {volume-name,volume-id,attachedto,volume-type}.as_count()","aggregator":"avg"}],"formulas":[{"alias":"Snapshot_Age","cell_display_mode":"bar","formula":"query1"},{"alias":"Throughput","cell_display_mode":"bar","formula":"query2"},{"alias":"IOPS_READ","cell_display_mode":"bar","formula":"query3","limit":{"count":500,"order":"desc"}},{"alias":"IOPS_WRITE","cell_display_mode":"bar","formula":"query4"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":9,"width":12,"height":4}},{"id":1087556319032282,"definition":{"type":"free_text","text":"SSQL","color":"#6915F0","font_size":"36","text_align":"left"},"layout":{"x":0,"y":13,"width":12,"height":1}},{"id":3188872181927036,"definition":{"title":"Volumes","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:aws.ebs.status.ok{attachedto:ssql*,$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {device}","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":false,"precision":0},"layout":{"x":0,"y":14,"width":3,"height":2}},{"id":3476415964566604,"definition":{"title":"Global Used","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":3,"y":14,"width":3,"height":2}},{"id":2082495677949956,"definition":{"title":"Global Free","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.free{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":6,"y":14,"width":3,"height":2}},{"id":6243773901635498,"definition":{"title":"Global Total","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":9,"y":14,"width":3,"height":2}},{"id":3990870807331574,"definition":{"title":"List","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_table","requests":[{"q":"avg:system.disk.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Used","cell_display_mode":["bar"],"aggregator":"avg"},{"q":"avg:system.disk.in_use{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"%","conditional_formats":[{"comparator":"<","palette":"red_on_white","value":0.4},{"comparator":"<","palette":"yellow_on_white","value":0.6}],"cell_display_mode":["bar"],"aggregator":"avg"},{"aggregator":"avg","conditional_formats":[{"comparator":">","palette":"white_on_red","value":250000000000}],"q":"avg:system.disk.free{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Free","limit":1000,"cell_display_mode":["number"],"order":"desc"},{"q":"avg:system.disk.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:ssql*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Total","cell_display_mode":["number"],"aggregator":"avg"}],"has_search_bar":"auto"},"layout":{"x":0,"y":16,"width":12,"height":4}},{"id":3041509350776842,"definition":{"type":"free_text","text":"SFLS","color":"#6915F0","font_size":"36","text_align":"left"},"layout":{"x":0,"y":20,"width":12,"height":1}},{"id":2610816115439180,"definition":{"title":"Volumes","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:aws.ebs.status.ok{$attachedto:sfls*,$Db-Instance,$Instance-Id,$instance-type,$OS,$Instance,$Provider} by {device}","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":false,"precision":0},"layout":{"x":0,"y":21,"width":3,"height":2}},{"id":873537865842552,"definition":{"title":"Global Used","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":3,"y":21,"width":3,"height":2}},{"id":6231157464339156,"definition":{"title":"Global Free","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.free{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":6,"y":21,"width":3,"height":2}},{"id":2455015822102354,"definition":{"title":"Global Total","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:system.disk.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":9,"y":21,"width":3,"height":2}},{"id":6155466540999932,"definition":{"title":"List","title_size":"16","title_align":"left","time":{"live_span":"15m"},"type":"query_table","requests":[{"q":"avg:system.disk.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Used","cell_display_mode":["bar"],"aggregator":"avg"},{"q":"avg:system.disk.in_use{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"%","conditional_formats":[{"comparator":"<","palette":"red_on_white","value":0.4},{"comparator":"<","palette":"yellow_on_white","value":0.6}],"cell_display_mode":["bar"],"aggregator":"avg"},{"aggregator":"avg","conditional_formats":[{"comparator":">","palette":"white_on_red","value":250000000000}],"q":"avg:system.disk.free{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Free","limit":1000,"cell_display_mode":["number"],"order":"desc"},{"q":"avg:system.disk.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance,name:sfls*,!filesystem:nfs*} by {device_name,filesystem,name,tenant_env,tenant_name}","alias":"Total","cell_display_mode":["number"],"aggregator":"avg"}],"has_search_bar":"auto"},"layout":{"x":0,"y":23,"width":12,"height":4}},{"id":1434007250654910,"definition":{"title":"Disk Used (%)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"%","formula":"(query1 / query2) * 100"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:system.disk.used{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name}","data_source":"metrics","name":"query1"},{"query":"avg:system.disk.total{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":" <20 % ","value":"0 < y < 20","display_type":"error dashed"},{"label":" <50 % ","value":"20 < y < 50","display_type":"warning dashed"}]},"layout":{"x":0,"y":27,"width":12,"height":5}}]},"layout":{"x":0,"y":2,"width":12,"height":1,"is_column_break":true}},{"id":3782430047697034,"definition":{"title":"RDS Instances","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":5910728578299586,"definition":{"title":"Instances","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:aws.rds.cpuutilization{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host,dbinstanceidentifier}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":false,"precision":0},"layout":{"x":0,"y":0,"width":5,"height":3}},{"id":3335003045512016,"definition":{"title":"Instances per family","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"avg:aws.rds.cpuutilization{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host}"}},"node_type":"host","no_metric_hosts":false,"no_group_hosts":true,"group":["dbinstanceclass"],"scope":["$Tenant"],"style":{"palette":"green_to_orange","palette_flip":false}},"layout":{"x":5,"y":0,"width":7,"height":3}},{"id":7586865925728202,"definition":{"title":"Overview per CPU Usage","title_size":"16","title_align":"left","show_legend":false,"time":{"live_span":"1mo"},"type":"distribution","xaxis":{"max":"100","min":"0"},"yaxis":{"include_zero":false,"scale":"log"},"markers":[],"requests":[{"q":"avg:aws.rds.cpuutilization{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {host,dbinstanceidentifier}","style":{"palette":"dog_classic"}}]},"layout":{"x":0,"y":3,"width":9,"height":3}},{"id":4171154735805716,"definition":{"type":"note","content":"## RDS family best practices :\n- https://richemont.sharepoint.com/sites/GT-ICS-Cloud_RIC-CH/SitePages/How-to-estimate-my-Cloud-Budget.aspx\n\n## RDS storage autoscaling \n- https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_PIOPS.StorageTypes.html\n\n## T3 CPU baseline :\n- https://aws.amazon.com/fr/ec2/instance-types/t3/","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":9,"y":3,"width":3,"height":3}},{"id":7765818749439762,"definition":{"title":"List","title_size":"16","title_align":"left","time":{},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:aws.rds.cpuutilization{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name,dbinstanceclass,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"avg:aws.rds.freeable_memory{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name,dbinstanceclass,availability-zone}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"avg:aws.rds.cpusurplus_credits_charged{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name,dbinstanceclass,availability-zone}","aggregator":"sum"},{"data_source":"metrics","name":"query4","query":"avg:aws.rds.free_storage_space{$Provider,$Instance,$OS,$instance-type,$Instance-Id,$Db-Instance} by {name,dbinstanceclass,availability-zone}","aggregator":"avg"}],"formulas":[{"alias":"cpu usage","conditional_formats":[{"palette":"red_on_white","value":20,"comparator":"<"},{"palette":"yellow_on_white","value":40,"comparator":"<"},{"palette":"white_on_green","value":60,"comparator":">"}],"cell_display_mode":"bar","formula":"query1"},{"alias":"MEmory available","cell_display_mode":"bar","formula":"query2","limit":{"count":500,"order":"desc"}},{"alias":"CREDITS CHARGED","cell_display_mode":"bar","formula":"query3"},{"alias":"Free Storage","cell_display_mode":"bar","formula":"query4"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":6,"width":12,"height":4}},{"id":2986844559447338,"definition":{"title":"RDS CPU Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"top10(query1)"}],"response_format":"timeseries","queries":[{"query":"avg:aws.rds.cpuutilization{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {dbinstanceidentifier}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":10,"width":12,"height":3}},{"id":1449449607418440,"definition":{"title":"RDS Free Memory Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"top(query1, 10, 'mean', 'desc')"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:aws.rds.freeable_memory{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {dbinstanceidentifier}","data_source":"metrics","name":"query1"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":13,"width":12,"height":3}},{"id":1132311136482728,"definition":{"title":"RDS Free Storage Overview","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"top(query1, 10, 'mean', 'desc')"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:aws.rds.free_storage_space{$instance-type,$OS,$Instance,$Provider,$Instance-Id,$Db-Instance} by {dbinstanceidentifier}","data_source":"metrics","name":"query1"}],"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":16,"width":12,"height":3}}]},"layout":{"x":0,"y":3,"width":12,"height":1}}],"template_variables":[{"name":"Provider","default":"*","prefix":"cloud_provider","available_values":[]},{"name":"Instance","default":"*","prefix":"name","available_values":[]},{"name":"OS","default":"*","prefix":"os","available_values":[]},{"name":"instance-type","default":"*","prefix":"instance-type","available_values":[]},{"name":"Instance-Id","default":"*","prefix":"instance_id","available_values":[]},{"name":"Db-Instance","default":"*","prefix":"dbinstanceidentifier","available_values":[]}],"layout_type":"ordered","is_read_only":false,"notify_list":[],"template_variable_presets":[{"name":"File Servers (SFLS)","template_variables":[{"name":"Tenant","value":"*managedservices"},{"name":"Instance","value":"sfls*"}]},{"name":"Managed Services Global","template_variables":[{"name":"Tenant","value":"*managedservices"}]},{"name":"SQL Servers (SSQL)","template_variables":[{"name":"Tenant","value":"*managedservices"},{"name":"Instance","value":"ssql*"}]}],"reflow_type":"fixed","id":"u6s-sb9-rft"}